# PAG Web 播放器 & 编辑器

一个功能完整的 Web 应用，用于加载、编辑和播放 PAG 动画文件。

## 功能特性

### ✅ 核心功能
1. **文件管理**
   - 浏览可用的 PAG 文件
   - 添加多个文件到播放列表
   - 移除播放列表中的文件

2. **播放控制**
   - 按顺序播放多个 PAG 文件
   - 播放/暂停控制
   - 上一个/下一个切换
   - 进度条拖拽
   - 自动循环播放

3. **内容编辑**
   - **文本编辑**
     - 修改文本内容
     - 调整字号
     - 更改颜色
   - **图片替换**
     - 上传新图片
     - 替换 PAG 中的图片层

4. **实时预览**
   - 实时渲染当前帧
   - 显示文件信息
   - 编辑后即时预览

## 安装和运行

### 1. 安装依赖

```bash
cd /Users/liujh/work/pag/libpag/python

# 激活虚拟环境
source venv/bin/activate

# 安装 Web 依赖
cd web
pip install -r requirements.txt
```

### 2. 启动服务器

```bash
python app.py
```

服务器将在 http://localhost:5000 启动

### 3. 访问应用

在浏览器中打开：http://localhost:5000

## 使用指南

### 添加 PAG 文件
1. 在左侧 "可用文件" 列表中，点击文件旁的 "添加" 按钮
2. 文件会被添加到右侧 "播放列表"

### 播放动画
1. 在播放列表中点击某个文件的 "播放" 按钮
2. 或使用底部的播放控制按钮
   - ▶ 播放/暂停
   - ⏮ 上一个
   - ⏭ 下一个
   - ⏹ 停止

### 编辑 PAG 内容
1. 点击播放列表中文件的 "编辑" 按钮
2. 编辑面板会展开，显示可编辑的内容：
   
   **文本编辑：**
   - 修改文本内容
   - 调整字号
   - 选择颜色
   - 点击 "更新文本" 保存

   **图片替换：**
   - 选择图片文件
   - 点击 "上传图片" 替换

3. 编辑后，文件会标记为 "已编辑" 🟠
4. 播放时会显示编辑后的版本

### 重置文件
点击 "重置到原始" 按钮可恢复文件到未编辑状态

## 技术架构

### 后端 (Flask)
- `app.py` - Flask 服务器
- RESTful API 设计
- pypag Python 绑定处理 PAG

### 前端 (HTML/CSS/JavaScript)
- 响应式单页应用
- 实时预览和交互
- 现代化 UI 设计

### API 端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/list-files` | GET | 获取可用 PAG 文件列表 |
| `/api/load` | POST | 加载 PAG 文件到播放列表 |
| `/api/playlist` | GET | 获取当前播放列表 |
| `/api/render/:id` | GET | 渲染指定 PAG 的帧 |
| `/api/edit/text` | POST | 编辑文本内容 |
| `/api/edit/image` | POST | 替换图片 |
| `/api/reset/:id` | POST | 重置到原始状态 |
| `/api/remove/:id` | DELETE | 从播放列表移除 |

## 界面预览

```
┌─────────────────────────────────────────────────────────────┐
│         🎬 PAG 播放器 & 编辑器                                │
├───────────┬─────────────────────────┬────────────────────────┤
│ 📁 可用文件 │      预览播放器           │   📋 播放列表          │
│           │                         │                        │
│ • like.pag│   ┌─────────────────┐   │ 1. text1.pag  [已编辑]│
│ • text1   │   │                 │   │    1280x721 | 0.43s  │
│ • test.pag│   │   [PAG 预览]    │   │    [播放][编辑][移除] │
│           │   │                 │   │                        │
│           │   └─────────────────┘   │ 2. like.pag            │
│           │   ━━━━━━━━━━━ 50%      │    244x244 | 1.17s    │
│           │   [⏮][▶][⏭][⏹]        │    [播放][编辑][移除] │
└───────────┴─────────────────────────┴────────────────────────┘
```

## 注意事项

1. **性能优化**
   - 实时渲染较大的 PAG 文件可能较慢
   - 建议播放列表不超过 10 个文件

2. **图片格式**
   - 支持 PNG、JPEG 等常见格式
   - 需要安装 Pillow 库

3. **浏览器兼容性**
   - 推荐使用 Chrome、Firefox、Safari 最新版
   - 需要支持 ES6 和 Fetch API

## 故障排除

### 问题：无法加载图片
- 确保已安装 Pillow: `pip install Pillow`

### 问题：渲染失败
- 检查 pypag 模块是否正确编译
- 查看终端错误日志

### 问题：文件列表为空
- 确认 `../assets/` 目录存在且包含 `.pag` 文件
- 检查文件路径权限

## 扩展功能（待实现）

- ⏳ 导出编辑后的 PAG 文件
- ⏳ 批量编辑多个文件
- ⏳ 导出为视频格式
- ⏳ 音频支持
- ⏳ 拖拽排序播放列表
- ⏳ 键盘快捷键

## 许可证

本项目基于 libpag 的许可证
